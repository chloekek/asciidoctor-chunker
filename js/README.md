# asciidoctor-chunker

Splits asciidoc book's single HTML file generated by Asciidoctor into chunks by chapters, sections and subsections.

## News

. 2020/2/??  Added support to split into chunking by sections and subsections. This is the complete rewrite in JavaScript and runs under Node environment.
. 2018/7/11  Locally linked files with `link` and `script` tags with relative paths are copied to the destination directory keeping the structure of the relative path.  So the custom CSS and script files should be properly copied by `asciidoctor-chunker`.

## What it Dose

Asciidoctor-Chunker generates chunked HTML from a single HTML generated by Asciidoctor.

1. Splits part preambles and chapters (or any depth of section level) into separate files. Each chapter can be configured to have different depth of extractions.
1. Places footnotes into the file where they are defined.
1. Places the multiply referred footnote into every referrer's files and sets the link back to the referrer's id whitin the page
rather than originally defined place.
1. Re-writes the relative links so they point to the chunked files.
1. Copies the local images and linked files (with `link` and `script` tags) whose path is relative, to the directory relative to the chuned html output.  Files are only copied if they are new or modified compareed to the copied targets.

Asciidoctor-Chunker does not add any contents nor change the structure of the source HTML.  However, the navigation link will be added in the future release.  These additonal modifications can be switched on and off with the configuration settings.

Here is [the sample output](http://www.seinan-gu.ac.jp/~shito/asciidoctor/html_chunk/index.html) created from the [Asciidoctor User Manual](https://asciidoctor.org/docs/user-manual/).  The footer on the sample page is added by setting the asciidoctor attribute and is not added by asciidoctor-chunker.


## Usage

Asciidoctor-Chunker is written in JavaScript and runs with NodeJS.roswell).

1. Install [Node](https://nodejs.org/)
1. Run the bundled script `asciidoctor-chunker.js` under `build` directory with NodeJS.
    ```
    $ node build/asiidoctor-chunker.js [single-html-file] -o [output-directory]
    ```
1. Alternatively you can run from this project root
    ```
    $ npm install     # required only once to install dependencies
    $ npm run [single-html-file] -o [output-directory]
    ```
`[single-html-file]` is the single HTML file generated by [Asciidoctor](https://asciidoctor.org) from the book doctype.  If the output directory is not specified, the default is `output` under the current directory.


## Example

The project contains the `example` directory where you can generate the chunked html for the [Asciidoctor User Manual](https://asciidoctor.org/docs/user-manual/) by invoking `make`.  Simply go into the `example` directory and invoke `make`.  This will clone the asciidoctor project from the github for the first time, then the chunked html will be generated under `test/output-chunk/html_chunk/` directory.  The `index.html` is the first page.

```
$ cd example
$ make
```

## License

MIT

## Developer's Memo

- Unit test uses `test/resources/output/single/sample.html` generated from `test/resources/sample.adoc`.
- `npm install cheerio`
- `npm install --save-dev ava`
